<script>
async function go() {
  const w = document.getElementById("wallet").value.trim();
  const r = document.getElementById("res"), s = document.getElementById("sh");
  r.textContent = "‚è≥ Checking...";
  s.style.display = "none";

  try {
    const j = await fetch("/api/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ wallet: w })
    }).then(r => r.json());

    if (!j.success) return r.textContent = "‚ùå " + j.error;

    const o = j.scores;
    const airdrop = o.estimated_u ?? "0";

    let txt = `
üíº Wallet: ${o.address}
üí´ Estimated Airdrop: ${airdrop} $U

üìä Scores:
‚Ä¢ Volume: ${o.volume_score}
‚Ä¢ Diversity: ${o.diversity_score}
‚Ä¢ Interaction: ${o.interaction_score}
‚Ä¢ Holding: ${o.holding_score}
‚Ä¢ Cosmos bonus: ${o.cosmos_bonus}
‚Ä¢ Union bonus: ${o.union_user_bonus}
`;

    if (j.activity?.length > 0) {
      txt += `\nüì¶ Transfers:\n`;
      j.activity.forEach(a => {
        txt += `‚Ä¢ ${a.amount.toFixed(4)} ${a.symbol}\n`;
      });
    }

    r.textContent = txt;
    const shareMsg = `I just estimated my $U airdrop: ${airdrop} ‚Äî Check yours at union.build/check`;
    document.getElementById("shl").href = "https://twitter.com/intent/tweet?text=" + encodeURIComponent(shareMsg);
    s.style.display = "block";

  } catch (e) {
    console.error(e);
    r.textContent = "‚ùå Error checking eligibility";
  }
}
</script>
