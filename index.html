<script>
async function go() {
  const w = document.getElementById("wallet").value.trim();
  const r = document.getElementById("res"), s = document.getElementById("sh");
  r.textContent = "â³ Checking...";
  s.style.display = "none";

  try {
    const j = await fetch("/api/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ wallet: w })
    }).then(r => r.json());

    if (!j.success) return r.textContent = j.error;

    const o = j.scores;
    const acts = j.activity || [];

    let txt = `ğŸ’¼ Wallet: ${o.address}\n`;

    if (o.fallback) {
      txt += `â„¹ï¸ No $U score found, but wallet has interacted with Union.\n\n`;
    }

    txt += `ğŸ’° Estimated Airdrop: ${o.estimated_u} $U\n\nğŸ“Š Score Breakdown:\n`;
    txt += `â€¢ Volume: ${o.volume_score}\nâ€¢ Diversity: ${o.diversity_score}\nâ€¢ Interaction: ${o.interaction_score}\nâ€¢ Holding: ${o.holding_score}\nâ€¢ Cosmos Bonus: ${o.cosmos_bonus}\nâ€¢ Union Bonus: ${o.union_user_bonus}\n`;

    if (acts.length > 0) {
      txt += `\nğŸ“¦ Transfers detected:\n`;
      for (const a of acts) {
        txt += `â€¢ ${a.amount.toFixed(4)} ${a.symbol}\n`;
      }
    }

    r.textContent = txt;

    const shareMsg = `Just checked my $U airdrop potential on @unionbuild ğŸª‚\nI might get ${o.estimated_u} $U!\nCheck yours: https://union-airdrop-checker.onrender.com`;
    document.getElementById("shl").href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareMsg)}`;
    s.style.display = "block";

  } catch (e) {
    r.textContent = "âŒ Error checking eligibility";
    console.error(e);
  }
}
</script>
