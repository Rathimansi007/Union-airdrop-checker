<script>
async function go() {
  const w = document.getElementById("wallet").value.trim();
  const r = document.getElementById("res"), s = document.getElementById("sh");
  r.textContent = "⏳ Checking...";
  s.style.display = "none";

  try {
    const j = await fetch("/api/check", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ wallet: w })
    }).then(r => r.json());

    if (!j.success) {
      return r.textContent = "❌ " + j.error;
    }

    const o = j.scores;
    const txt = `
💼 Wallet: ${o.address}
💰 Estimated Airdrop: ${o.estimated_u} $U

📊 Score Breakdown:
• Volume: ${o.volume_score}
• Diversity: ${o.diversity_score}
• Interaction: ${o.interaction_score}
• Holding: ${o.holding_score}
• Cosmos Bonus: ${o.cosmos_bonus}
• Union Bonus: ${o.union_user_bonus}
    `;

    r.textContent = txt;

    // Create share link
    const shareText = `Just checked my potential $U airdrop on @unionbuild 🚀\nI might get ${o.estimated_u} $U!\nCheck yours here: https://union-airdrop-checker.onrender.com 🪂`;
    const tweetLink = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}`;

    const shareBtn = document.getElementById("shl");
    shareBtn.href = tweetLink;
    s.style.display = "block";

  } catch (e) {
    r.textContent = "❌ Error checking eligibility";
    console.error(e);
  }
}
</script>
